#!/usr/bin/perl -X
use strict;
use warnings;
use JSON::XS;
use Data::Printer;
use AI::MicroStructure;
#use AI::MicroStructure::Fitnes;
#use AI::MicroStructure::Categorizer;
#use AI::MicroStructure::Memorizer;
#use AI::MicroStructure::Tree;
#use AI::MicroStructure::Collection;
use Storable::CouchDB;
my @ARGVX = ();





  sub checkIsThere {

    my $key =shift;


    require LWP::UserAgent;
    my $ua = LWP::UserAgent->new;
    my ($server,$db) = (sprintf("http://%s:5984","localhost"),"table");

   my $res ;
                                
    $res = $ua->get(sprintf('%s/%s/_design/base/_view/instances?reduce=false&start_key=["%s"]&end_key=["%sz"]',
                              $server,
                              $db,
                              $key,
                              $key));


$res = decode_json($res->content);
return @{$res->{rows}};
    
  
}


   our $x = Storable::CouchDB->new(
                                      uri =>"http://hagen:hagen123pass\@localhost:5984/",  #default
                                      db  =>"table"
                                     );



$ARGV[0]='film';
$ARGV[0] = sprintf (`micro`)unless @ARGV;
$ARGV[0]=~ s/\n//g;
my @q=();
my @set = checkIsThere($ARGV[0]);
print  map{  push @q,$_->{id} unless(!$_->{id});}@set;
print join "\n",@q;
map{ $x->delete($_); }@q;
  
#p @set;
#print map{  p @set,$x;}@set;
#map{ $x->delete($_->{id}); }@set;
  
  1;
  
  __END__
