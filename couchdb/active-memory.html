<html>
  <head>
    <meta charset="utf-8">
    <link rel="stylesheet" type="text/css" href="lib/main.css" />

  <meta charset="utf-8"> <script src="http://yui.yahooapis.com/3.6.0/build/yui/yui-min.js"></script> <script src="http://code.jquery.com/jquery-latest.js"></script>  <link href="http://127.0.0.1:5984/app/_design/base/basex.css" media="screen" rel="stylesheet" type="text/css">  <link href="http://127.0.0.1:5984/app/_design/base/scope.css" media="screen" rel="stylesheet" type="text/css"> <style> body{font-color:#ffffff;background:#000044;} .todo-view { border-bottom: 1px dotted #CFCFCF; overflow: hidden; } #todo-stats {  margin: 0em auto;  text-align: left; } #todo-list { top:100px;  position:absolute;  min-width:300px; height:100px;   list-style: none;  padding: 0;  overflow: hide; } #todo-stats, .todo-clear { color: #777; } .todo-clear { float: right; } .todo-done .todo-content {  color: #666;  text-decoration: line-through; } .todo-edit, .editing .todo-view { display: none; } .editing .todo-edit { display: block; } .todo-input {  display: block;  font-family: Helvetica, sans-serif;  font-size: 15px;  line-height: normal;  margin: 5px auto 0;  padding: 6px;  width: 115px; } .todo-item {  border-bottom: 1px dotted #cfcfcf;  font-size: 15px;  padding: 6px;  position: relative; } .todo-label {  color: #444;  font-size: 15px;  font-weight: bold;  text-align: center; } .todo-remaining {  color: #333;  font-weight: bold; } .todo-remove {  position: absolute;  right: 0;  top: 12px; } .todo-remove-icon {  /*  Delete icon courtesy of The Noun Project:  http://thenounproject.com/noun/delete/  background: url(../assets/app/remove.png) no-repeat;  */  display: block;  height: 16px;  opacity: 0.6;  visibility: hidden;  width: 23px; } .todo-remove:hover .todo-remove-icon { opacity: 1.0; } .todo-hover .todo-remove-icon, .todo-remove:focus .todo-remove-icon { visibility: visible; } .editing .todo-remove-icon { visibility: hidden; } .goin{ float:right; display:inline; } #demo { } /*  // border-left: 1px solid black;  // border-right: 1px solid black; // font-weight:bold; */ .counter{ text-align:center; font-size:1em; display:inline; color:orange; } #demo ul li {  border-bottom: 1px dotted #CFCFCF;  overflow: hidden;  background-color: #fff;  cursor: move;  color:blue;  width:500px:  margin: 1em;  list-style-type: none;  z-index: 1;  zoom: 1;  text-align:left; } #play {  position: relative;  zoom: 1; } #drop {  border: 1px solid black;  background-color: #eee;  height: 5px;  color:#fff;  width:500px;  position: absolute;  bottom: 5px;  right: 5px;  zoom: 1; } #box {  display: block;  float: left;  font-style:normal;  text-align:center;  line-height:40px;  border: 1px solid #fff;  margin: 6px 0;  color:#99CCCC;  font-size:90%;  -moz-box-shadow:4px 4px 7px rgba(0,0,0, 0.4);  -webkit-box-shadow:4px 4px 7px rgba(0,0,0, 0.4);  box-shadow:4px 4px 7px rgba(0,0,0, 0.4);  -moz-border-radius:3px;  -webkit-border-radius:3px;  cursor: move; } #drop strong {  font-weight: bold; } #drop.yui3-dd-drop-over {  background-color: #ccc; }  select {  display:inline;  width:200px;  margin: 15px;  }  #X{  display: inline;  font-family: Helvetica, sans-serif;  font-size: 14px;  line-height: normal;  margin: 5px auto 0;  padding: 5px;  width:340px;  }  button {  display: inline-block;  zoom: 1;  font-family: Helvetica, sans-serif;  line-height: normal;  margin: 5px auto 0;  padding: 6px;  text-align: left;  }  input {  display: inline-block;  zoom: 1;  font-family: Helvetica, sans-serif;  line-height: normal;  margin: 5px;  padding: 10px;  width: 140px;  }  a,table,tr,td {  margin:5px;  font-size:1.05em;  }  #demo{  padding:15px;  margin-left:1%;  margin-right:1%;  }  #am{  text-align: center;  margin-top:100px;  padding:4px;  } </style>
<title>You are not alone</title>

  </head>
  <body bgcolor="#000044" text="#ffffcc">

<table border="0" cellpadding="0" cellspacing="0" width="100%" height="100%">
<tr>
<td valign="top">
    <canvas id="canvas">    </canvas>

    <div id="ui">
      <div id="fps"></div>

      <input id="chat" type="text" />


      <h1>micros</h1>

      <div id="instructions">
        <h2>Instructions</h2>
      </div>

       <div id="fwa">


       </div><!-- #fwa -->

    <aside id="info">
      <section id="share">


      </section>

        <section id="wtf">
        </section>
        <section id="concept">
        </section>
      </aside>
            <aside id="frogMode">

                <section id="tadpoles">
                    <h4></h4>
                    <ul id="tadpoleList">
                    </ul>
                </section>
                <section id="console">
                    <h4></h4>
                </section>
            </aside>

      <div id="cant-connect">
        Ooops.<br />
      </div>
      <div id="unsupported-browser">
        <p>
          Your browser doesn't support our technology. Either it is too old or <a rel="external" href="http://en.wikipedia.org/wiki/WebSocket">WebSockets</a> is disabled.
          We recommend one of the following browsers.
        </p>
        <ul>
          <li><a rel="external" href="http://www.google.com/chrome">Google Chrome</a></li>
          <li><a rel="external" href="http://apple.com/safari">Safari 4</a></li>
          <li><a rel="external" href="http://www.mozilla.com/firefox/">Firefox 4</a></li>
          <li><a rel="external" href="http://www.opera.com/">Opera 11</a></li>
        </ul>
        <p>
          <a href="#" id="force-init-button">I don't care. Let me in!</a>
        </p>
      </div>

    </div>

    <script src="lib/parseUri.js"></script>
    <script src="lib/modernizr-1.5.min.js"></script>
    <script src="lib/Stats.js"></script>

    <script src="lib/WebSocketService.js"></script>
    <script src="lib/Model.js"></script>
    <script src="lib/Settings.js"></script>
    <script src="lib/Keys.js"></script>
    <script src="lib/Camera.js"></script>

    <script src="lib/formControls.js"></script>

  <nav>  </nav>
<div id="main-container"  style="color:ffffcc; top:10px; position:absolute;">
<div id="main">
<div id="webSocketSupp"></div>
<div style="display:none;" id="noWebSocketSupp">
<div style="float: left;">  </div>
<div style="float: left; width: 60px; margin-left: 1px;">
<p>Uh-oh, the browser you're using doesn't have native support for WebSocket. That means you can't run this demo.</p>  <p>The following link lists the browsers that support WebSocket:</p>
</div>  </div>
<div id="echo">
<div id="echo-config" >
<button id="send" class="box">Send</button>
<div id="chatText"></div>

<div style="display:none;">
<input id="wsUri" size="13" value="ws://127.0.0.1:3000" disabled="">
 <input type="checkbox" id="secureCb" onclick="toggleTls();" style="display:none;" disabled="">
   <span id="secureCbLabel" style="font-size: smaller; color: rgb(153, 153, 153); display:none;">Use secure WebSocket (TLS)</span>
    <button id="connect" disabled="">Connect</button>
    <button id="disconnect">Disconnect</button>
</div>
    <button id="clearLogBut">Clear log</button>
     <div id="consoleLog"  style="color:ffffcc;"></div>
      </div>
<div class="clearfix"></div>

 <script>
 var secureCb;
 var secureCbLabel;
 var wsUri;
 var consoleLog;
 var connectBut;
 var disconnectBut;
 var sendMessage;
 var sendBut;
 var clearLogBut;
 function echoHandlePageLoad()
 {
 if (window.WebSocket)
 {
 document.getElementById("webSocketSupp").style.display = "block";
 }
 else
 {
 document.getElementById("noWebSocketSupp").style.display = "block";
 }
 secureCb = document.getElementById("secureCb");
 secureCb.checked = false;
 secureCb.onclick = toggleTls;
 secureCbLabel = document.getElementById("secureCbLabel")
 wsUri = document.getElementById("wsUri");
 toggleTls();
 connectBut = document.getElementById("connect");
 connectBut.onclick = doConnect;
 disconnectBut = document.getElementById("disconnect");
 disconnectBut.onclick = doDisconnect;
 sendMessage = document.getElementById("chatText");
 sendBut = document.getElementById("send");
 sendBut.onclick = doSend;
 consoleLog = document.getElementById("consoleLog");
 clearLogBut = document.getElementById("clearLogBut");
 clearLogBut.onclick = clearLog;
 setGuiConnected(false);
 document.getElementById("disconnect").onclick = doDisconnect;
 document.getElementById("send").onclick = doSend;
 }
 function toggleTls()
 {
 var wsPort = (window.location.port.toString() === "" ? "" : ":"+window.location.port)
 if (wsUri.value === "") {
 wsUri.value = "ws://" + window.location.hostname.replace("www", "echo") + wsPort;
 }
 if (secureCb.checked)
 {
 wsUri.value = wsUri.value.replace("ws:", "wss:");
 }
 else
 {
 wsUri.value = wsUri.value.replace ("wss:", "ws:");
 }
 }
 function doConnect()
 {
 if (window.MozWebSocket)
 {
 logToConsole('<span style="color: red;"><strong>Info:</strong> This browser supports WebSocket using the MozWebSocket constructor</span>');
 window.WebSocket = window.MozWebSocket;
 }
 else if (!window.WebSocket)
 {
 logToConsole('<span style="color: red;"><strong>Error:</strong> This browser does not have support for WebSocket</span>');
 return;
 }
 // prefer text messages
 var uri = wsUri.value;
 if (uri.indexOf("?") == -1) {
 uri += "?encoding=text";
 } else {
 uri += "&encoding=text";
 }
 websocket = new WebSocket(uri);
 websocket.onopen = function(evt) { onOpen(evt) };
 websocket.onclose = function(evt) { onClose(evt) };
 websocket.onmessage = function(evt) { onMessage(evt) };
 websocket.onerror = function(evt) { onError(evt) };
 }
 function doDisconnect()
 {
 websocket.close()
 }
 function doSend()
 {

 logToConsole("SENT: " + $("#chatText").html());
 websocket.send($("#chatText").html());
 }
 function writeElem(message,i){
 var xmessage = '<li class="todo-view"><span class="todo-content" tabindex="'+i+'">'+message+'</span></div></li>';
 $("#todo-list").append(xmessage);
 }
 function logToConsole(message)
 {
 var pre = document.createElement("p");
 pre.style.wordWrap = "break-word";
 pre.innerHTML = getSecureTag()+message;
 consoleLog.appendChild(pre);
 while (consoleLog.childNodes.length > 500)
 {
 consoleLog.removeChild(consoleLog.firstChild);
 }
 consoleLog.scrollTop = consoleLog.scrollHeight;
 }
 function onOpen(evt)
 {
 logToConsole("CONNECTED");
 setGuiConnected(true);
 }
 function onClose(evt)
 {
 logToConsole("DISCONNECTED");
 setGuiConnected(false);
 }
 function onMessage(evt)
 {
 if(evt.data.match("{")){
 var elem = JSON.parse(evt.data.toString());
 var xlist = elem.responce[0];
 $("#todo-list").empty();

 for(a in xlist){
iterateAttributesAndFormHTMLLabels(xlist[a],a);
 }}
 }
 function onError(evt)
 {
 logToConsole('<span style="color: red;">ERROR:</span> ' + evt.data);
 }
 function setGuiConnected(isConnected)
 {
 wsUri.disabled = isConnected;
 connectBut.disabled = isConnected;
 disconnectBut.disabled = !isConnected;
 sendBut.disabled = !isConnected;
 secureCb.disabled = isConnected;
 var labelColor = "black";
 if (isConnected)
 {
 labelColor = "#999999";
 }
 secureCbLabel.style.color = labelColor;
 }
 function clearLog()
 {
 while (consoleLog.childNodes.length > 0)
 {
 consoleLog.removeChild(consoleLog.lastChild);
 }
 $("#todo-list").empty();
 }
 function getSecureTag()
 {
 if (secureCb.checked)
 {
 return 'lock';
 }
 else
 {
 return '';
 }
 }
 window.addEventListener("load", echoHandlePageLoad, false);
 </script>
 <script>
 $('#webSocketSupp').fadeIn(250);
 setTimeout(function(){$('#webSocketSupp').fadeOut(250,function(){
 document.getElementById("connect").click();
 $('#webSocketSupp').remove();
 $('#connect').click(1);
 })},250);
 </script>


 <ul id="todo-list" style="overflow:scrolling;"> </ul>
</td>
<td>

<div id="canvas" />
</td>
<td align="center" >
<table border="0" cellpadding="0" cellspacing="0" valign='top'>
<tr>
<td>
<pre  style="zoom:50%;color:ffffcc;">
                          ;;;;;;iiiii;;
                 i!!!!!!!!!!!!!!!~{:!!!!i
             i!~!!))!!!!!!!!!!!!!!!!!!!!!!!!
          i!!!{!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!i
       i!!)!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
    '!h!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
  '!!`!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!i
   /!!!~!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
' ':)!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
  ~:!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
..!!!!!\!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
 `!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
 ~ ~!!!)!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!~
~~'~{!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!:'~
{-{)!!{!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!:!
`!!!!{!~!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!':!!!
' {!!!{>)`!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!)!~..
:!{!!!{!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!! -!!:
    ~:!4~/!!!!!!!!!!!!!!!!!!!~!!!!!!!!!!!!!!!!!!!!!!!!!!
     :~!!~)(!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
      ``~!!).~!!!!!!!!!!!!!{!!!!!!!!!!!!!!!!!!!!!!!!!!!!!:
            ~  '!\!!!!!!!!!!(!!!!!!!!!!!!!!!!!!!!!!4!!!~:
           '      '--`!!!!!!!!/:\!!{!!((!~.~!!`?~-      :
              ``-.    `~!{!`)(>~/ \~                   :
   .                \  : `{{`. {-   .-~`              /
    .          !:       .\\?.{\   :`      .          :!
    \ :         `      -~!{:!!!\ ~     :!`         .>!
    '  ~          '    '{!!!{!!!t                 ! !!
     '!  !.            {!!!!!!!!!              .~ {~!
      ~!!..`~:.       {!!!!!!!!!!:          .{~ :LS{
       `!!!!!!h:!?!!!!!!!!!!!!!(!!!!::..-~~` {!!!!.
         4!!!!!!!!!!!!!!!!!!!!!~!{!~!!!!!!!!!!!!'
          `!!!!!!!!!!!!!!!!!!!!(~!!!!!!!!!!!!!~
            `!!!!!!!!!!!{\``!!``(!!!!!!!!!~~  .
             `!!!!!!!!!!!!!!!!!!!!!!!!(!:
               .!!!!!!!!!!!!!!!!!!!!!\~
               .`!!!!!!!/`.;;~;;`~!! '
                 -~!!!!!!!!!!!!!(!!/ .
                    `!!!!!!!!!!!!!!'
                      `\!!!!!!!!!~

</pre>
</td>
</tr>
</table>
</td>
</tr>
</table>

<script>


      function iterateAttributesBase(o){
          var s = '';
          var show = "";
          var img ="";

          for(var a in o){

              if(o.value &&
                 o.value[1].spawn &&
                 !contains(check,o.value[0])){

                 check.push(o.value[0]);

                      if(o.value[0]){




         var meta ='&nbsp;<span style="padding:8px;color:black;"><b>spawn</b>'+o.value[1].spawn+'&nbsp;|&nbsp;';

         if(o.value[3].image && o.value[3].image.length)  {
                                    meta+='<b>image</b>:&nbsp;'+o.value[3].image.length+'&nbsp;|&nbsp;';
                                    meta+='<b>headings</b>:&nbsp;'+o.value[3].headings.length+'&nbsp;|&nbsp;';
                                    meta+='<b>related</b>:&nbsp;'+o.value[3].related.length+'&nbsp;|&nbsp;';
                                    meta+='<b>categories</b>:&nbsp;'+o.value[3].categories.length+'&nbsp;|&nbsp;';
                                    meta+='<b>members</b>:&nbsp;'+o.value[3].members.length+'</span>';
        }

                    var pdff="";
                    if(o.value[3].pdf.length){
                        pdff="<div style='display:inline;'>";

                        for(var pdf in o.value[3].pdf){
                          pdff+="<a style='display:inline;' href='"+o.value[3].pdf[pdf]+"'>";
                          pdff+="<img src='http://localhost:5984/app/_design/base/media.png'  /></a>";
                        }
                        pdff+="</div>";
                  }


                    var count = 0;
                    var nextar = [];
                    var ss ='<ul class="contributors" style="float:right;padding:10px;">';

                    for(var image in o.value[3].image){
                      if(o.value[3].image[image] && !o.value[3].image[image].match(/(MIME type|\<)/)){

                        count = (o.value[3].image[image].split("upload").length - 1);


                        if(count==1){
                            ss+='<li class="contributor" id="img'+countx+'Cont">';
                            ss+='<a class="avatar" href="'+o.value[3].image[image]+'" title="" target="new">';
                            ss+='<img alt="avatar" src=""  id="img'+countx+'" width="'+102+'" height="'+102+'">';
                            ss+='<span class="contributor-name">'+image+'</span>';
                            ss+='<span class="contributor-contributions">'+image+'</span>';
                            ss+='</a>';
                            ss+='</li>';
                            countximage.push(o.value[3].image[image]);
                            countx++;
                        }

                        }
                    }


          ss+='</ul>';

               var text = clean(o.value[0]);
               text = $.trim(text);

                var color = o.value[0].match(/ncident/)? "#ff0000" :"#ffffff";


 //onClick=loadImages('+countximage.length+','+o.value[3].image.length+');

                  s+='<div  class="aBox" style="width:90%;background:'+color+';padding:2px" id="'+text+'" ';
                  s+=' >';
                  s+='';
                  s+='<div><a href="#'+text+'" onClick=opener("'+text+'"); ><span class="blue" style="font-size:20px;">'+
                      '<img src="http://localhost:5984/app/_design/base/tiny-right.png" />'+text+'</a><div style="float:right;">'+meta+'</div></div>';
                  s+='<div style="padding:2px;">'+pdff+'</div>';
                 var tagstr = "";
                 for(var tag in o.key){

                 if(tagstr && tagstr.length<150) {  if(o.key[tag]){ tagstr += o.key[tag]+"&nbsp;|&nbsp;"; } };


                 }
                 s+= "<span class='font-size:9px;margin:5px;'>"+tagstr+'</span><hr>';

if(o.value[3].related){

var lists ='<center class="ff" style="font-size:16px;">click any item</center><br><table align="center" width="98%" style="background-color:#fff;margin:10px;" cellspacing="5" cellpadding="5">'+
           '<tr><th>headings</th><th>categorys lists related</th></tr>'+
           '<tr><td><ul><li onclick=onclick=goTox(this,-1,"'+o.value[0]+'"); >';

if(o.value[3].headings.length){
    lists += o.value[3].headings.join('</li><li onclick=onclick=goTox(this,-1,"'+o.value[0]+'"); class="todo-view">')+'</li></ul>';
}else{
    lists += o.value[3].members.join('</li><li onclick=onclick=goTox(this,-1,"'+o.value[0]+'"); class="todo-view">')+'</li></ul>';

}
lists += '<td><ul><li onclick=onclick=goTox(this,0,"'+o.value[0]+'"); class="todo-view">'+o.value[3].cat.join('</li><li onclick=onclick=goTox(this,0,"'+o.value[0]+'"); class="todo-view">')+
           '</li></ul><hr><ul ><li onclick=onclick=goTox(this,1,"'+o.value[0]+'"); class="todo-view">'+
            o.value[3].list.join('</li><li onclick=onclick=goTox(this,1,"'+o.value[0]+'"); class="todo-view">')+
           '</li></ul><hr><ul><li onclick=onclick=goTox(this,2,"'+o.value[0]+'"); class="todo-view">'+o.value[3].related.join('</li><li onclick=onclick=goTox(this,2,"'+o.value[0]+'"); class="todo-view">')+
           '</li></ul></td></tr></table>';
}


lists = lists.replace(/http:\/\/en.wikipedia.org\/wiki\//gi,"");
lists = lists.replace(/Category:/gi,"");
lists = lists.replace(/List_of_/gi,"");

  ss+="";



                  s +="<div id='image_"+text+"'></div>"+lists+"<div id='text_"+text+"'></div></div>";

                  ss="";


//              }

              }


              }

              if (typeof o[a] == 'object'){
              s += iterateAttributesBase(o[a]);
              }else{

//                s+='<hr><br><a href="'+o[a]+'" target="new"  style="color:blue"><font color=blue>'+o[a]+'</a>';

              }//end if
          }//end for
          return s;
      }//end function

 function xArticles(query)
 {

      var DB = "http://localhost:5984/table";
      $.ajax({
         url: DB+'/_design/base/_view/articles?reduce=false&'+
        'start_key=["'+query+'"]&end_key=["'+query+'ZZZ"]',

                beforeSend:function(){},
                success: function (data){

                    var view = JSON.parse(data);
                    var tasks = [];
                    var html = iterateAttributesBase(view);
                    $('#concept').empty()
                    $('#concept').append(html)


                },
  error:function(){
    $('#concept').html('<p class="error"><strong>Oops!</strong> Try that again in a few moments.</p>');
  }
             });


 }
 function xSend(message)
 {


      //alert('Index: ' + $(message).html());
      var sendMessage = $.trim($(message).html()).split(":");
      clearLog();
      var q = $.trim(sendMessage[1]);
      $("#chatText").html(q);
      $("#send").click();

      xArticles(q);



 }

 function iterateAttributesAndFormHTMLLabels(o,xi){
 var s = '';

if(xi<15){
 $("#todo-list").append('<li onclick="xSend(this);" style="margin:1px;background:#fff;color:#000;><span style="display:inline;color:#fff;">'+'['+o.spawn +']:'+o.neighbour+'</span></li>');
}
 return s;
}


</script>

  </body>
</html>


